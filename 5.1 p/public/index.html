<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Books Catalog - SIT725 5.1P</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>Books Catalog</h1>
    <p>List of books (title — author)</p>
    <button id="fetchBtn">Fetch books</button>
    <div id="loading"></div>
    <div id="error" class="error"></div>
    <ul id="booksList"></ul>
  </div>

  <script>
    const fetchBtn = document.getElementById('fetchBtn');
    const booksList = document.getElementById('booksList');
    const loading = document.getElementById('loading');
    const errorDiv = document.getElementById('error');

    function render(items) {
      booksList.innerHTML = '';
      if (!Array.isArray(items) || items.length === 0) {
        booksList.textContent = 'No items';
        return;
      }
      items.forEach(it => {
        const li = document.createElement('li');
        li.innerHTML = '<span class="title">' + it.title + '</span>' +
                       '<span class="author"> — ' + it.author + '</span>';
        booksList.appendChild(li);
      });
    }

    async function fetchBooks() {
      loading.textContent = 'Loading...';
      errorDiv.textContent = '';
      try {
        const res = await fetch('/api/books');
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const body = await res.json(); // { statusCode, data, message }
        render(body.data);
      } catch (err) {
        console.error(err);
        errorDiv.textContent = 'Error fetching books: ' + err.message;
      } finally {
        loading.textContent = '';
      }
    }

    fetchBtn.addEventListener('click', fetchBooks);
    window.addEventListener('load', fetchBooks);
  </script>
</body>
</html>
