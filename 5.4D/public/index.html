<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Books Catalogue — SIT725</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="container" role="main" aria-labelledby="pageTitle">
    <header>
      <h1 id="pageTitle">Books Catalogue — developed by s225576827</h1>
      <p style="text-align:center; color:#666; margin-top:-10px; margin-bottom:18px;">
        Click <strong>Get all books</strong> to load the catalogue from the server.
      </p>
    </header>

    <section style="text-align:center;">
      <button id="fetchBtn" type="button">Get all books</button>
    </section>

    <section id="status" style="margin-top:12px;">
      <div id="loading"></div>
      <div id="error" class="error" style="color:red;"></div>
    </section>

    <section style="margin-top:18px;">
      <ul id="booksList"></ul>
      <p style="color:#777; font-size:13px; margin-top:6px;">
        Click any book to view full details.
      </p>
    </section>

    <aside id="bookDetails" style="display:none; margin-top:22px; padding:14px; border-radius:10px; background:#fff;">
      <button id="closeDetails" style="float:right;">Close</button>
      <h2 id="d_title"></h2>
      <p><strong>Author:</strong> <span id="d_author"></span></p>
      <p><strong>Year:</strong> <span id="d_year"></span></p>
      <p><strong>Genre:</strong> <span id="d_genre"></span></p>
      <p><strong>Summary:</strong></p>
      <p id="d_summary"></p>
      <p><strong>Price (AUD):</strong> <span id="d_price"></span></p>
    </aside>

    <footer style="text-align:center; margin-top:28px; color:#999; font-size:13px;">
      SIT725 — Practical 5.4D
    </footer>
  </main>

  <script>
    const fetchBtn = document.getElementById('fetchBtn');
    const booksList = document.getElementById('booksList');
    const loading = document.getElementById('loading');
    const errorDiv = document.getElementById('error');

    const bookDetails = document.getElementById('bookDetails');
    const d_title = document.getElementById('d_title');
    const d_author = document.getElementById('d_author');
    const d_year = document.getElementById('d_year');
    const d_genre = document.getElementById('d_genre');
    const d_summary = document.getElementById('d_summary');
    const d_price = document.getElementById('d_price');
    const closeDetails = document.getElementById('closeDetails');

    function showLoading(msg) {
      loading.textContent = msg;
    }
    function hideLoading() {
      loading.textContent = '';
    }
    function showError(msg) {
      errorDiv.textContent = msg;
    }
    function clearError() {
      errorDiv.textContent = '';
    }

    
    function formatPrice(p) {
      if (!p) return '';
      if (typeof p === 'object' && p.$numberDecimal) {
        return Number(p.$numberDecimal).toFixed(2) + ' AUD';
      }
      const n = Number(p);
      return Number.isNaN(n) ? '' : n.toFixed(2) + ' AUD';
    }

    function renderList(items) {
      booksList.innerHTML = '';
      if (!Array.isArray(items) || items.length === 0) {
        booksList.innerHTML = '<li>No books found.</li>';
        return;
      }

      items.forEach(it => {
        if (!it || !it.title) return;

        const li = document.createElement('li');
        li.innerHTML = `
          <strong>${it.title}</strong><br/>
          ${it.author} — ${formatPrice(it.price)}
        `;
        li.style.cursor = 'pointer';
        li.onclick = () => showDetails(it.id);
        booksList.appendChild(li);
      });
    }

    async function fetchBooks() {
      clearError();
      showLoading('Loading books...');
      try {
        const res = await fetch('/api/books');
        const body = await res.json();
        renderList(body.data || []);
      } catch (err) {
        showError(err.message);
      } finally {
        hideLoading();
      }
    }

    async function showDetails(id) {
      clearError();
      showLoading('Loading details...');
      try {
        const res = await fetch('/api/books/' + id);
        const body = await res.json();

        
        const b = body.data || body;

        d_title.textContent = b.title || '';
        d_author.textContent = b.author || '';
        d_year.textContent = b.year || '';
        d_genre.textContent = b.genre || '';
        d_summary.textContent = b.summary || '';
        d_price.textContent = formatPrice(b.price);

        bookDetails.style.display = 'block';
      } catch (err) {
        showError(err.message);
      } finally {
        hideLoading();
      }
    }

    closeDetails.onclick = () => {
      bookDetails.style.display = 'none';
    };

    fetchBtn.onclick = fetchBooks;
  </script>
</body>
</html>
